@startuml component-high-level
'
' EpiSense - Diagrama de Contextos Simplificado
'
!theme vibrant
skinparam handwritten true
skinparam backgroundColor White
skinparam componentStyle rectangle
skinparam defaultTextAlignment center
skinparam shadowing false

title EpiSense - Visão Simplificada por Contextos

package "Sistemas Externos" #LightGray {
  [Servidor FHIR] <<Fonte de Dados>>
  [App dos Gestores] <<Cliente>>
  [Serviço de Push (FCM)] <<Infraestrutura>>
}

package "Sistema EpiSense" #White {
  
  frame "Contexto: API Principal" {
    component [API Gateway] as Api
  }

  frame "Contexto: Mecanismo de Análise" {
    component [Analysis Engine] as Engine
  }

  frame "Contexto: Serviço de Alertas" {
    component [Alert Service] as Alerter
  }

  database "Repositório de Dados\n(MongoDB)" as Mongo
}

' Fluxos de Dados Principais
[Servidor FHIR] --> Api : 1. Envia Hemograma (FHIR)
Api --> Mongo : 2. Persiste dado bruto
Api --> Engine : 3. Dispara Análise

Engine -> Mongo : 4. Lê dados para análise
Engine -> Mongo : 5. Salva agregados/resultados

Engine --> Alerter : 6. Notifica sobre padrão detectado

Alerter -> Mongo : 7. Registra Alerta
Alerter --> [Serviço de Push (FCM)] : 8. Envia Push

[App dos Gestores] --> Api : 9. Consulta Alertas

@enduml